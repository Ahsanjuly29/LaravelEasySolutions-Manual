
# ðŸ§­ Laravel Event Listeners â€” Advanced Usage & Scoped Disabling

A professional guide on writing, managing, and controlling Laravel Event Listeners using clean architecture principles (SOLID) and real-world patterns.

---

## ðŸ“˜ Contents

1. [ðŸŽ¯ Why Use Events & Listeners](#-why-use-events--listeners)
2. [ðŸ—ï¸ Proper Listener Architecture (SOLID)](#-proper-listener-architecture-solid)
3. [âš™ï¸ Registering Events & Listeners](#ï¸-registering-events--listeners)
4. [ðŸš« Temporarily Disabling Listeners (Scoped)](#-temporarily-disabling-listeners-scoped)
5. [ðŸ§ª Testing Events & Listeners](#-testing-events--listeners)
6. [ðŸ“š References](#-references)

---

## ðŸŽ¯ Why Use Events & Listeners?

**Events** help decouple core logic from side effects.

```text
Action (e.g., OrderShipped)
   â†“
Event â†’ Multiple Listeners â†’ Notification, Email, Logging, External API
```

âœ… Promotes **Separation of Concerns**
âœ… Easier to **extend** (add/remove listeners)
âœ… Great for **testing & isolation**

---

## ðŸ—ï¸ Proper Listener Architecture (SOLID)

Follow **SRP**, **DI**, and clean boundaries.

### ðŸ§© 1. Create Event

```bash
php artisan make:event OrderShipped
```

ðŸ“„ `App\Events\OrderShipped.php`

```php
class OrderShipped
{
    public function __construct(public Order $order) {}
}
```

### ðŸ§© 2. Create Listener

```bash
php artisan make:listener SendShipmentNotification
```

ðŸ“„ `App\Listeners\SendShipmentNotification.php`

```php
class SendShipmentNotification
{
    public function __construct(
        private NotificationService $notifier // Inject services, don't use facades directly
    ) {}

    public function handle(OrderShipped $event): void
    {
        $order = $event->order;

        $this->notifier->sendToCustomer(
            $order->user->email,
            'Your order has shipped!',
            view('emails.shipped', compact('order'))->render()
        );
    }
}
```

> ðŸ“Œ Use injected services, **not static facades**. Improves testability and respects **D**ependency Inversion.

---

## âš™ï¸ Registering Events & Listeners

ðŸ“„ `App\Providers\EventServiceProvider.php`

```php
protected $listen = [
    \App\Events\OrderShipped::class => [
        \App\Listeners\SendShipmentNotification::class,
        \App\Listeners\LogOrderShipment::class,
    ],
];
```

âœ… Laravel auto-discovers listeners if you use event/listener classes generated by Artisan.

---

## ðŸš« Temporarily Disabling Listeners (Scoped)

Sometimes you want to dispatch an event **without triggering some or all listeners**. For example:

* Bulk import
* Seeding
* Controlled logic

### ðŸ”§ SOLUTION: Scoped Disabling with Re-register

#### ðŸ“„ `App\Support\EventSilencer.php`

```php
namespace App\Support;

use Illuminate\Support\Facades\Event;

class EventSilencer
{
    protected array $forgotten = [];

    public function without(callable $callback, array $eventsToForget): mixed
    {
        // Backup listeners
        foreach ($eventsToForget as $event => $listeners) {
            $this->forgotten[$event] = Event::getListeners($event);

            foreach ($listeners as $listener) {
                Event::forget($event);
            }
        }

        // Run callback
        $result = $callback();

        // Restore listeners
        foreach ($this->forgotten as $event => $listeners) {
            foreach ($listeners as $listener) {
                Event::listen($event, $listener);
            }
        }

        return $result;
    }
}
```

#### âœ… Usage

```php
use App\Support\EventSilencer;
use App\Events\OrderShipped;
use App\Listeners\SendShipmentNotification;

$silencer = new EventSilencer();

$silencer->without(function () use ($order) {
    event(new OrderShipped($order));
}, [
    OrderShipped::class => [
        SendShipmentNotification::class,
    ]
]);
```

---

## ðŸ§ª Testing Events & Listeners

### âœ… Assert Event Was Dispatched

```php
Event::fake();

event(new OrderShipped($order));

Event::assertDispatched(OrderShipped::class);
```

### âœ… Assert Listener Was Not Run

Use Laravel's `Event::fakeFor()`:

```php
Event::fakeFor(function () use ($order) {
    event(new OrderShipped($order));
});

Event::assertNotDispatched(OrderShipped::class);
```

---

## ðŸ” Optional: Globally Disable All Listeners

You can create an Artisan command or global config to conditionally forget multiple listeners (e.g., via `.env`):

```php
if (config('app.disable_event_listeners')) {
    Event::forget(OrderShipped::class);
}
```

---

## ðŸ“š References

* [Laravel Events & Listeners (Docs)](https://laravel.com/docs/events)
* [Service Container & DI in Laravel](https://laravel.com/docs/container)
* [StackOverflow â€“ Temporarily Disabling Listeners](https://stackoverflow.com/q/29407818)

---

## âœ… Summary

| Feature                        | Ready? |
| ------------------------------ | ------ |
| Clean Event-Listener structure | âœ…      |
| SOLID-based listener injection | âœ…      |
| Scoped listener disabling      | âœ…      |
| Testable and reusable          | âœ…      |
| Low coupling, high flexibility | âœ…      |

> Use events as part of a scalable, maintainable, and decoupled Laravel application structure.

---

Happy coding!
ðŸš€ *Build smarter, not messier.*

```

easy-laravel-events/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Events/
â”‚   â”‚   â””â”€â”€ OrderShipped.php
â”‚   â”œâ”€â”€ Listeners/
â”‚   â”‚   â””â”€â”€ SendShipmentNotification.php
â”‚   â”œâ”€â”€ Support/
â”‚   â”‚   â””â”€â”€ EventSilencer.php
â”‚   â””â”€â”€ Services/
â”‚       â””â”€â”€ NotificationService.php (dummy placeholder)
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ Feature/
â”‚       â””â”€â”€ EventListenerTest.php
â”œâ”€â”€ README.md
â”œâ”€â”€ composer.json
â””â”€â”€ routes/
    â””â”€â”€ web.php
